var Photon;
(function(e){var a=function(a,c,d){"undefined"===typeof c&&(c="");"undefined"===typeof d&&(d="");this.url=a;this.subprotocol=c;this.keepAliveTimeoutMs=5E3;this._frame="~m~";this._isClosing=this._isConnected=this._isConnecting=!1;this._peerStatusListeners={};this._eventListeners={};this._responseListeners={};this.keepAliveTimer=0;this._logger=new Exitgames.Common.Logger(d&&""!=d?d+": ":"")};a.prototype.isConnecting=function(){return this._isConnecting};a.prototype.isConnected=function(){return this._isConnected};a.prototype.isClosing=
function(){return this._isClosing};a.prototype.connect=function(){var a=this;this._socket=""==this.subprotocol?new WebSocket(this.url):new WebSocket(this.url,this.subprotocol);this._onConnecting();this._socket.onopen=function(){};this._socket.onmessage=function(c){c=a._decode(c.data);a._onMessage(c.toString())};this._socket.onclose=function(c){a._logger.debug("onclose: wasClean =",c.wasClean,", code=",c.code,", reason =",c.reason);a._isConnecting?a._onConnectFailed(c):(1006==c.code&&a._onTimeout(),
a._onDisconnect())};this._socket.onerror=function(c){a._onError(c)}};a.prototype.disconnect=function(){this._isClosing=!0;this._socket.close()};a.prototype.sendOperation=function(a,c){var d={req:a,vals:[]};if(Exitgames.Common.Util.isArray(c))d.vals=c;else if(void 0===c)d.vals=[];else throw Error(this._logger.format("PhotonPeer[sendOperation] - Trying to send non array data:",c));this._send(d);this._logger.debug("PhotonPeer[sendOperation] - Sending request:",d)};a.prototype.addPeerStatusListener=function(a,
c){this._addListener(this._peerStatusListeners,a,c)};a.prototype.addEventListener=function(a,c){this._addListener(this._eventListeners,a.toString(),c)};a.prototype.addResponseListener=function(a,c){this._addListener(this._responseListeners,a.toString(),c)};a.prototype.removePeerStatusListener=function(a,c){this._removeListener(this._peerStatusListeners,a,c)};a.prototype.removeEventListener=function(a,c){this._removeListener(this._eventListeners,a.toString(),c)};a.prototype.removeResponseListener=
function(a,c){this._removeListener(this._responseListeners,a.toString(),c)};a.prototype.removePeerStatusListenersForCode=function(a){this._removeListenersForCode(this._peerStatusListeners,a)};a.prototype.removeEventListenersForCode=function(a){this._removeListenersForCode(this._eventListeners,a.toString())};a.prototype.removeResponseListenersForCode=function(a){this._removeListenersForCode(this._responseListeners,a.toString())};a.prototype.setLogLevel=function(a){this._logger.setLevel(a)};a.prototype.onUnhandledEvent=
function(a){this._logger.warn("PhotonPeer: No handler for event",a,"registered.")};a.prototype.onUnhandledResponse=function(a){this._logger.warn("PhotonPeer: No handler for response",a,"registered.")};a.StatusCodes={connecting:"connecting",connect:"connect",connectFailed:"connectFailed",disconnect:"disconnect",connectClosed:"connectClosed",error:"error",timeout:"timeout"};a.prototype._dispatchEvent=function(a,c){if(!this._dispatch(this._eventListeners,a.toString(),c,"event"))this.onUnhandledEvent(a,
c)};a.prototype._dispatchResponse=function(a,c){if(!this._dispatch(this._responseListeners,a.toString(),c,"response"))this.onUnhandledResponse(a,c)};a.prototype._stringify=function(a){if("[object Object]"==Object.prototype.toString.call(a)){if(!JSON)throw Error("PhotonPeer[_stringify] - Trying to encode as JSON, but JSON.stringify is missing.");return"~j~"+JSON.stringify(a)}return String(a)};a.prototype._encode=function(a){for(var c="",d,a=Exitgames.Common.Util.isArray(a)?a:[a],b=0,i=a.length;b<i;b++)d=
null===a[b]||void 0===a[b]?"":this._stringify(a[b]),c+=this._frame+d.length+this._frame+d;return c};a.prototype._decode=function(a){var c=[],d,b;d=a;-1!==a.indexOf("\x00")&&(d=a.replace(/[\0]/g,""));a=d;do{if(a.substr(0,3)!==this._frame)break;a=a.substr(3);d="";for(var i=0,e=a.length;i<e;i++)if(b=Number(a.substr(i,1)),a.substr(i,1)==b)d+=b;else{a=a.substr(d.length+this._frame.length);d=Number(d);break}c.push(a.substr(0,d));a=a.substr(d)}while(""!==a);return c};a.prototype._onMessage=function(a){"~j~"==
a.substr(0,3)?this._onMessageReceived(JSON.parse(a.substr(3))):this._sessionid?this._onMessageReceived(a):(this._sessionid=a,this._onConnect())};a.prototype.resetKeepAlive=function(){var a=this;clearTimeout(this.keepAliveTimer);1E3<=this.keepAliveTimeoutMs&&(this.keepAliveTimer=setTimeout(function(){return a._send({irq:1,vals:[1,Date.now()]},!0)},this.keepAliveTimeoutMs))};a.prototype._send=function(a,c){"undefined"===typeof c&&(c=!1);var d=this._encode(a);if(this._isConnected&&!this._isClosing)this.resetKeepAlive(),
this._socket.send(d);else if(!c)throw Error(this._logger.format("PhotonPeer[_send] - Operation",a.req,'- failed, "isConnected" is',this._isConnected,', "isClosing" is',this._isClosing,"!"));};a.prototype._onMessageReceived=function(a){if("object"===typeof a)if(this._logger.debug("PhotonPeer[_onMessageReceived] - Socket received message:",a),a.vals=void 0!==a.vals?a.vals:[],0<a.vals.length&&(a.vals=this._parseMessageValuesArrayToJSON(a.vals)),void 0!==a.res){var c=parseInt(a.res);this._parseResponse(c,
a)}else if(void 0!==a.evt)c=parseInt(a.evt),this._parseEvent(c,a);else if(void 0!==a.irs)c=parseInt(a.irs),this._parseInternalResponse(c,a);else throw Error(this._logger.format("PhotonPeer[_onMessageReceived] - Received undefined message type:",a));};a.prototype._parseMessageValuesArrayToJSON=function(a){var c={};if(Exitgames.Common.Util.isArray(a))if(0==a.length%2)for(var d,b;0<a.length;)d=a.shift()+"",b=a.shift(),c[d]=b;else throw Error(this._logger.format("PhotonPeer[_parseMessageValuesToJSON] - Received invalid values array:",
a));return c};a.prototype._parseEvent=function(a,c){switch(a){default:this._dispatchEvent(a,{vals:c.vals})}};a.prototype._parseResponse=function(a,c){switch(a){default:this._dispatchResponse(a,{errCode:c.err,errMsg:c.msg,vals:c.vals})}};a.prototype._parseInternalResponse=function(a,c){this._logger.debug("internal response:",c)};a.prototype._onConnecting=function(){this._logger.debug("PhotonPeer[_onConnecting] - Starts connecting",this.url,'..., raising "connecting" event ...');this._isConnecting=
!0;this._dispatchPeerStatus(a.StatusCodes.connecting)};a.prototype._onConnect=function(){this._logger.debug('PhotonPeer[_onConnect] - Connected successfully! Raising "connect" event ...');this._isConnecting=!1;this._isConnected=!0;this._dispatchPeerStatus(a.StatusCodes.connect)};a.prototype._onConnectFailed=function(){this._logger.error("PhotonPeer[_onConnectFailed] - Socket connection could not be created:",this.url,this.subprotocol,'Wrong host or port?\n Raising "connectFailed event ...');this._isConnecting=
this._isConnected=!1;this._dispatchPeerStatus(a.StatusCodes.connectFailed)};a.prototype._onDisconnect=function(){var g=this._isConnected,c=this._isClosing;this._logger.debug('PhotonPeer[_onDisconnect] - Socket closed, raising "disconnect" event ...');this._isClosing=this._isConnected=this._isConnecting=!1;g&&(c?this._dispatchPeerStatus(a.StatusCodes.disconnect):this._dispatchPeerStatus(a.StatusCodes.connectClosed))};a.prototype._onTimeout=function(){this._logger.debug('PhotonPeer[_onTimeout] - Client timed out! Raising "timeout" event ...');
this._dispatchPeerStatus(a.StatusCodes.timeout)};a.prototype._onError=function(g){this._logger.error("PhotonPeer[_onError] - Connection error:",g);this._isConnecting=this._isConnected=this._isClosing=!1;this._dispatchPeerStatus(a.StatusCodes.error)};a.prototype._addListener=function(a,c,d){c in a||(a[c]=[]);d&&"function"===typeof d?(this._logger.debug("PhotonPeer[_addListener] - Adding listener for event",c),a[c].push(d)):this._logger.error("PhotonPeer[_addListener] - Listener",c,"is not a function but of type",
typeof d,". No listener added!");return this};a.prototype._dispatch=function(a,c,d){if(c in a){for(var a=a[c],c=0,b=a.length;c<b;c++)Exitgames.Common.Util.isArray(d)||(d=[d]),a[c].apply(this,void 0===d?[]:d);return!0}return!1};a.prototype._dispatchPeerStatus=function(a){this._dispatch(this._peerStatusListeners,a,void 0,"peerStatus")||this._logger.warn("PhotonPeer[_dispatchPeerStatus] - No handler for ",a,"registered.")};a.prototype._removeListener=function(a,c,d){if(c in a){var b=a[c].length;a[c]=
a[c].filter(function(a){return a!=d});this._logger.debug("PhotonPeer[_removeListener] - Removing listener for event",c,"removed:",b-a[c].length)}return this};a.prototype._removeListenersForCode=function(a,c){this._logger.debug("PhotonPeer[_removeListenersForCode] - Removing all listeners for event",c);c in a&&(a[c]=[]);return this};e.PhotonPeer=a})(Photon||(Photon={}));var Exitgames;
(function(e){var e=e.Common||(e.Common={}),a=function(c,d){"undefined"===typeof c&&(c="");"undefined"===typeof d&&(d=a.Level.INFO);this.prefix=c;this.level=d};a.prototype.setLevel=function(c){c=Math.max(c,a.Level.DEBUG);this.level=c=Math.min(c,a.Level.OFF)};a.prototype.isLevelEnabled=function(a){return a>=this.level};a.prototype.getLevel=function(){return this.level};a.prototype.debug=function(c){for(var d=[],b=0;b<arguments.length-1;b++)d[b]=arguments[b+1];this.log(a.Level.DEBUG,c,d)};a.prototype.info=
function(c){for(var d=[],b=0;b<arguments.length-1;b++)d[b]=arguments[b+1];this.log(a.Level.INFO,c,d)};a.prototype.warn=function(c){for(var d=[],b=0;b<arguments.length-1;b++)d[b]=arguments[b+1];this.log(a.Level.WARN,c,d)};a.prototype.error=function(c){for(var d=[],b=0;b<arguments.length-1;b++)d[b]=arguments[b+1];this.log(a.Level.ERROR,c,d)};a.prototype.format=function(a){for(var d=[],b=0;b<arguments.length-1;b++)d[b]=arguments[b+1];return this.format0(a,d)};a.prototype.formatArr=function(a,d){return this.format0(a,
d)};a.Level={DEBUG:1,INFO:2,WARN:3,ERROR:4,OFF:6};a.log_types=["debug","debug","info","warn","error"];a.prototype.log=function(c,d,b){if(c>=this.level&&"undefined"!==typeof console&&void 0!==d)try{var i=console[a.log_types[c]];i||(i=console.log);i&&(i.call?i.call(console,this.format0(d,b)):i(console,this.format0(d,b)))}catch(e){}};a.prototype.format0=function(a,d){return this.prefix+a+" "+d.map(function(a){if(void 0!==a)switch(typeof a){case "object":try{return JSON.stringify(a)}catch(d){return a.toString()+
"("+d+")"}default:return a.toString()}}).join(" ")};e.Logger=a;var g=function(){};g.indexOf=function(a,d,b){for(var i=a.length,b=0>b?Math.max(0,i+b):b||0;b<i;b++)if(a[b]===d)return b;return-1};g.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)};g.merge=function(a,d){for(var b in d)d.hasOwnProperty(b)&&(a[b]=d[b])};g.getPropertyOrElse=function(a,d,b){return a.hasOwnProperty(d)?a[d]:b};g.enumValueToName=function(a,d){for(var b in a)if(d==a[b])return b;return"undefined"};
e.Util=g})(Exitgames||(Exitgames={}));(function(e){e=e.Lite||(e.Lite={});e=e.Constants||(e.Constants={});e.LiteOpKey={ActorList:252,ActorNr:254,ActorProperties:249,Add:238,Broadcast:250,Cache:247,Code:244,Data:245,GameId:255,GameProperties:248,Group:240,Properties:251,ReceiverGroup:246,Remove:239,TargetActorNr:253};e.LiteEventCode={Join:255,Leave:254,PropertiesChanged:253};e.LiteOpCode={ChangeGroups:248,GetProperties:251,Join:255,Leave:254,RaiseEvent:253,SetProperties:252}})(Photon||(Photon={}));
var __extends=this.__extends||function(e,a){function g(){this.constructor=e}g.prototype=a.prototype;e.prototype=new g};
(function(e){var a=e.Lite||(e.Lite={}),g=e.PhotonPeer,c=function(a,b){"undefined"===typeof b&&(b="");g.call(this,a,b);this.isJoined=!1;this.roomName="";this.room={properties:{}};this.actors={};this._myActor={photonId:null,properties:{}}};__extends(c,g);c.prototype.myActor=function(){return this._myActor};c.prototype.join=function(d,b,c,e){if(void 0!==d&&this.isConnected()&&!this.isJoined){this._logger.info("PhotonPeer.Lite[join] - Joining roomName:",d);this._logger.debug("PhotonPeer.Lite[join] - actorProperties:",
c,", roomProperties:",b,", broadcast:",e);var g=[];g.push(a.Constants.LiteOpKey.GameId);g.push(d+"");"object"===typeof b&&(g.push(a.Constants.LiteOpKey.GameProperties),g.push(b));"object"===typeof c&&(g.push(a.Constants.LiteOpKey.ActorProperties),g.push(c));g.push(a.Constants.LiteOpKey.Broadcast);g.push(e||!1);this.sendOperation(a.Constants.LiteOpCode.Join,g)}else{if(void 0===d)throw Error("PhotonPeer.Lite[join] - Trying to join with undefined roomName!");if(this.isJoined)throw Error("PhotonPeer.Lite[join] - you have already joined!");
throw Error("PhotonPeer.Lite[join] - Not connected!");}};c.prototype.leave=function(){if(this.isJoined)this._logger.debug("PhotonPeer.Lite[leave] - Leaving ..."),this.sendOperation(a.Constants.LiteOpCode.Leave);else throw Error("PhotonPeer.Lite[leave] - Not joined!");};c.prototype.raiseEvent=function(d,b){if(this.isJoined)if(void 0!==b)this._logger.debug("PhotonPeer.Lite[raiseEvent] - Event",d,":",b),this.sendOperation(a.Constants.LiteOpCode.RaiseEvent,[a.Constants.LiteOpKey.Code,d,a.Constants.LiteOpKey.Data,
b]);else throw Error(this._logger.format("PhotonPeer.Lite[raiseEvent] - Event",d,"- data not passed in as object!"));else throw Error("PhotonPeer.Lite[raiseEvent] - Not joined!");};c.prototype.setActorProperties=function(d,b,c){if(this.isJoined)this._logger.debug("PhotonPeer.Lite[setActorProperties] - actorNumber:"+d+", broadcast:"+c+", data:",b),this.sendOperation(a.Constants.LiteOpCode.SetProperties,[a.Constants.LiteOpKey.Broadcast,c,a.Constants.LiteOpKey.Properties,b,a.Constants.LiteOpKey.ActorNr,
d]);else throw Error("PhotonPeer.Lite[setActorProperties] - Not joined!");};c.prototype.getActorProperties=function(d,b){if(this.isJoined){var c=[];c.push(a.Constants.LiteOpKey.ActorProperties);void 0!==d&&Exitgames.Common.Util.isArray(d)&&0<d.length&&c.push(d);2!==c.length&&c.push(null);c.push(a.Constants.LiteOpKey.ActorList);void 0!==b&&Exitgames.Common.Util.isArray(b)&&0<b.length&&c.push(b);4!==c.length&&c.push(null);c.push(a.Constants.LiteOpKey.Properties);c.push(2);this._logger.debug("PhotonPeer.Lite[getActorProperties] -",
c);this.sendOperation(a.Constants.LiteOpCode.GetProperties,c)}else throw Error("PhotonPeer.Lite[getProperties] - Not joined!");};c.prototype.setRoomProperties=function(c,b){if(this.isJoined)this._logger.debug("PhotonPeer.Lite[setRoomProperties] - broadcast:"+b+", data:",c),this.sendOperation(a.Constants.LiteOpCode.SetProperties,[a.Constants.LiteOpKey.Broadcast,b,a.Constants.LiteOpKey.Properties,c]);else throw Error("PhotonPeer.Lite[setRoomProperties] - Not joined!");};c.prototype.getRoomProperties=
function(c){if(this.isJoined){var b=[];b.push(a.Constants.LiteOpKey.GameProperties);void 0!==c?Exitgames.Common.Util.isArray(c)&&0<c.length&&b.push(c):b.push(null);this._logger.debug("PhotonPeer.Lite[getRoomProperties] -",b);this.sendOperation(a.Constants.LiteOpCode.GetProperties,b)}else throw Error("PhotonPeer.Lite[getRoomProperties] - Not joined!");};c.prototype._addActor=function(a){this.actors[a]={photonId:a};this._logger.debug("PhotonPeer.Lite[_addActor] - Added actorNr",a,"actors known are now ",
this.actors);return this.actors[a]};c.prototype._removeActor=function(a){delete this.actors[a];this._logger.debug("PhotonPeer.Lite[_removeActor] - Removed actorNr",a,", actors known are now",this.actors);return this};c.prototype.actorNrFromVals=function(a){a=a[e.Lite.Constants.LiteOpKey.ActorNr];return void 0!==a?parseInt(a):-1};c.prototype._parseEvent=function(c,b){var e=this.actorNrFromVals(b.vals);switch(c){case a.Constants.LiteEventCode.Join:this._onEventJoin(b,e);break;case a.Constants.LiteEventCode.Leave:this._onEventLeave(e);
break;case a.Constants.LiteEventCode.PropertiesChanged:this._onEventSetProperties(b,e);break;default:this._logger.info("PhotonPeer.Lite[_parseEvent] - Unknown event code",c,"with JSON:",b),this._dispatchEvent(c,{vals:b.vals,actorNr:e})}};c.prototype._onEventJoin=function(c,b){if(b!==this._myActor.photonId)this._logger.debug("PhotonPeer.Lite[_onEventJoin] - ActorNr",b,"joined."),this._addActor(b),this._dispatchEvent(a.Constants.LiteEventCode.Join,{newActors:[b]});else{var e=c.vals[a.Constants.LiteOpKey.ActorList],
g=[],j;for(j in e)b=parseInt(e[j]),b!==this._myActor.photonId&&void 0===this.actors[b]&&(this._logger.debug("PhotonPeer.Lite[_onEventJoin] - ActorNr",b,"registered as already joined"),this._addActor(b),g.push(b));this._dispatchEvent(a.Constants.LiteEventCode.Join,{newActors:g})}};c.prototype._onEventLeave=function(c){this._logger.debug("PhotonPeer.Lite[_onEventLeave] - ActorNr",c,"left");this._removeActor(c);this._dispatchEvent(a.Constants.LiteEventCode.Leave,{actorNr:c})};c.prototype._onEventSetProperties=
function(){};c.prototype._parseResponse=function(c,b){var e=this.actorNrFromVals(b.vals);switch(c){case a.Constants.LiteOpCode.Join:this._onResponseJoin(e);break;case a.Constants.LiteOpCode.Leave:this._onResponseLeave(e);break;case a.Constants.LiteOpCode.RaiseEvent:break;case a.Constants.LiteOpCode.GetProperties:this._onResponseGetProperties(b);break;case a.Constants.LiteOpCode.SetProperties:this._onResponseSetProperties(b,e);break;default:this._logger.debug("PhotonPeer.Lite[_parseResponse] - Unknown response code",
c,b,"actorNr",e),this._dispatchResponse(c,{errCode:b.err,errMsg:b.msg,vals:b.vals,actorNr:e})}};c.prototype._onResponseGetProperties=function(c){this._logger.debug("PhotonPeer.Lite[_onResponseGetProperties] - getProperties response:",c);if(void 0!==c.vals[a.Constants.LiteOpKey.ActorProperties]){var b=c.vals[a.Constants.LiteOpKey.ActorProperties],e;for(e in b)this.actors[e].properties=b[e]}void 0!==c.vals[a.Constants.LiteOpKey.GameProperties]&&(this.room.properties=c.vals[a.Constants.LiteOpKey.GameProperties]);
this._dispatchResponse(a.Constants.LiteOpCode.GetProperties,{vals:c.vals})};c.prototype._onResponseJoin=function(c){this.isJoined=!0;"object"===typeof this._myActor&&(this._myActor=this._addActor(c),this._logger.debug("PhotonPeer.Lite[_onResponseJoin] - You joined as actor number / myActor.photonId has been set to:",this._myActor.photonId));this._dispatchResponse(a.Constants.LiteOpCode.Join,{actorNr:c})};c.prototype._onResponseLeave=function(c){this.isJoined=!1;this._removeActor(this._myActor.photonId);
this._logger.debug("PhotonPeer.Lite[_onResponseLeave] - You left the room",this.roomName);this.roomName="";this.room={properties:{}};this._dispatchResponse(a.Constants.LiteOpCode.Leave,{actorNr:c})};c.prototype._onResponseSetProperties=function(c,b){this._logger.debug("PhotonPeer.Lite[_onResponseSetProperties] - setProperties response:",c,"actorNr",b);this._dispatchResponse(a.Constants.LiteOpCode.SetProperties,{vals:c.vals,actorNr:b})};a.LitePeer=c})(Photon||(Photon={}));
(function(e){var a=e.LoadBalancing||(e.LoadBalancing={}),a=a.Constants||(a.Constants={});a.LiteOpKey=e.Lite.Constants.LiteOpKey;a.LiteOpCode=e.Lite.Constants.LiteOpCode;a.LiteEventCode=e.Lite.Constants.LiteEventCode;a.ErrorCode={Ok:0,OperationNotAllowedInCurrentState:-3,InvalidOperationCode:-2,InternalServerError:-1,InvalidAuthentication:32767,GameIdAlreadyExists:32766,GameFull:32765,GameClosed:32764,NoRandomMatchFound:32760,GameDoesNotExist:32758,MaxCcuReached:32757,InvalidRegion:32756};a.ActorProperties=
{PlayerName:255};a.GameProperties={MaxPlayers:255,IsVisible:254,IsOpen:253,PlayerCount:252,Removed:251,PropsListedInLobby:250,CleanupCacheOnLeave:249};a.EventCode={GameList:230,GameListUpdate:229,QueueState:228,AppStats:226,AzureNodeInfo:210,Join:a.LiteEventCode.Join,Leave:a.LiteEventCode.Leave,PropertiesChanged:a.LiteEventCode.PropertiesChanged};a.ParameterCode={Address:230,PeerCount:229,GameCount:228,MasterPeerCount:227,UserId:225,ApplicationId:224,Position:223,MatchMakingType:223,GameList:222,
Secret:221,AppVersion:220,AzureNodeInfo:210,AzureLocalNodeId:209,AzureMasterNodeId:208,RoomName:a.LiteOpKey.GameId,Broadcast:a.LiteOpKey.Broadcast,ActorList:a.LiteOpKey.ActorList,ActorNr:a.LiteOpKey.ActorNr,PlayerProperties:a.LiteOpKey.ActorProperties,CustomEventContent:a.LiteOpKey.Data,Data:a.LiteOpKey.Data,Code:a.LiteOpKey.Code,GameProperties:a.LiteOpKey.GameProperties,Properties:a.LiteOpKey.Properties,TargetActorNr:a.LiteOpKey.TargetActorNr,ReceiverGroup:a.LiteOpKey.ReceiverGroup,Cache:a.LiteOpKey.Cache,
CleanupCacheOnLeave:241,Group:a.LiteOpKey.Group,Remove:a.LiteOpKey.Remove,Add:a.LiteOpKey.Add,ClientAuthenticationType:217,ClientAuthenticationParams:216};a.OperationCode={Authenticate:230,JoinLobby:229,LeaveLobby:228,CreateGame:227,JoinGame:226,JoinRandomGame:225,Leave:a.LiteOpCode.Leave,RaiseEvent:a.LiteOpCode.RaiseEvent,SetProperties:a.LiteOpCode.SetProperties,GetProperties:a.LiteOpCode.GetProperties,ChangeGroups:a.LiteOpCode.ChangeGroups};a.MatchmakingMode={FillRoom:0,SerialMatching:1,RandomMatching:2};
a.EventCaching={DoNotCache:0,MergeCache:1,ReplaceCache:2,RemoveCache:3,AddToRoomCache:4,AddToRoomCacheGlobal:5,RemoveFromRoomCache:6,RemoveFromRoomCacheForActorsLeft:7};a.ReceiverGroup={Others:0,All:1,MasterClient:2};a.CustomAuthenticationType={Custom:0,None:255}})(Photon||(Photon={}));
(function(e){var a=e.LoadBalancing||(e.LoadBalancing={}),g=function(a,b,f){this.name=a;this.actorNr=b;this.isLocal=f;this.customProperties={}};g.prototype.getRoom=function(){return this.loadBalancingClient.myRoom()};g.prototype.raiseEvent=function(a,b,f){this.loadBalancingClient&&this.loadBalancingClient.raiseEvent(a,b,f)};g.prototype.setName=function(a){this.name=a};g.prototype.onPropertiesChange=function(){};g.prototype.getCustomProperty=function(a){return this.customProperties[a]};g.prototype.getCustomPropertyOrElse=
function(a,b){return Exitgames.Common.Util.getPropertyOrElse(this.customProperties,a,b)};g.prototype.setCustomProperty=function(a,b){this.customProperties[a]=b;if(this.loadBalancingClient&&this.loadBalancingClient.isJoinedToRoom()){var f={};f[a]=b;this.loadBalancingClient._setPropertiesOfActor(f);this.onPropertiesChange(f)}};g.prototype._getAllProperties=function(){var k={};k[a.Constants.ActorProperties.PlayerName]=this.name;for(var b in this.customProperties)k[b]=this.customProperties[b];return k};
g.prototype._setLBC=function(a){this.loadBalancingClient=a};g.prototype._updateFromResponse=function(k){this.actorNr=k[a.Constants.ParameterCode.ActorNr];k=k[a.Constants.ParameterCode.PlayerProperties];if(void 0!==k){var b=k[a.Constants.ActorProperties.PlayerName];void 0!==b&&(this.name=b);this._updateCustomProperties(k)}};g.prototype._updateMyActorFromResponse=function(k){this.actorNr=k[a.Constants.ParameterCode.ActorNr]};g.prototype._updateCustomProperties=function(a){for(var b in a)this.customProperties[b]=
a[b];this.onPropertiesChange(a)};g._getActorNrFromResponse=function(b){return b[a.Constants.ParameterCode.ActorNr]};a.Actor=g;var c=function(a){this.address=this.name="";this.maxPlayers=0;this.isOpen=this.isVisible=!0;this.playerCount=0;this.cleanupCacheOnLeave=this.removed=!1;this._customProperties={};this._propsListedInLobby=[];this.name=a};c.prototype.onPropertiesChange=function(){};c.prototype.getCustomProperty=function(a){return this._customProperties[a]};c.prototype.getCustomPropertyOrElse=
function(a,b){return Exitgames.Common.Util.getPropertyOrElse(this._customProperties,a,b)};c.prototype._updateFromMasterResponse=function(b){this.address=b[a.Constants.ParameterCode.Address];if(b=b[a.Constants.ParameterCode.RoomName])this.name=b};c.prototype._updateFromProps=function(b,c){"undefined"===typeof c&&(c=null);if(b){this.maxPlayers=this.updateIfExists(this.maxPlayers,a.Constants.GameProperties.MaxPlayers,b);this.isVisible=this.updateIfExists(this.isVisible,a.Constants.GameProperties.IsVisible,
b);this.isOpen=this.updateIfExists(this.isOpen,a.Constants.GameProperties.IsOpen,b);this.playerCount=this.updateIfExists(this.playerCount,a.Constants.GameProperties.PlayerCount,b);this.removed=this.updateIfExists(this.removed,a.Constants.GameProperties.Removed,b);this._propsListedInLobby=this.updateIfExists(this._propsListedInLobby,a.Constants.GameProperties.PropsListedInLobby,b);this.cleanupCacheOnLeave=this.updateIfExists(this.cleanupCacheOnLeave,a.Constants.GameProperties.CleanupCacheOnLeave,b);
var f={};null===c&&(c=b);for(var d in c)parseInt(d).toString()!=d&&this._customProperties[d]!==c[d]&&(this._customProperties[d]=c[d],f[d]=c[d]);this.onPropertiesChange(f)}};c.prototype.updateIfExists=function(a,b,c){return c.hasOwnProperty(b)?c[b]:a};a.RoomInfo=c;var d=function(a){c.call(this,a)};__extends(d,c);d.prototype.setCustomProperty=function(a,b){this._customProperties[a]=b;if(this.loadBalancingClient&&this.loadBalancingClient.isJoinedToRoom()){var c={};c[a]=b;this.loadBalancingClient._setPropertiesOfRoom(c)}c=
{};c[a]=b;this.onPropertiesChange(c)};d.prototype.setProp=function(a,b){if(this.loadBalancingClient&&this.loadBalancingClient.isJoinedToRoom()){var c={};c[a]=b;this.loadBalancingClient._setPropertiesOfRoom(c)}};d.prototype.setIsVisible=function(b){this.isVisible!=b&&(this.isVisible=b,this.setProp(a.Constants.GameProperties.IsVisible,b))};d.prototype.setIsOpen=function(b){this.isOpen==!b&&(this.isOpen=b,this.setProp(a.Constants.GameProperties.IsOpen,b))};d.prototype.setMaxPlayers=function(b){this.maxPlayers!=
b&&(this.maxPlayers=b,this.setProp(a.Constants.GameProperties.MaxPlayers,b))};d.prototype.setPropsListedInLobby=function(a){this._propsListedInLobby=a};d.prototype._setLBC=function(a){this.loadBalancingClient=a};a.Room=d;var b=function(c,h,f){this.masterServerAddress=c;this.appId=h;this.appVersion=f;this.reconnectPending=this.keepMasterConnection=!1;this.roomInfos=[];this.actors={};this.userAuthType=a.Constants.CustomAuthenticationType.None;this.userAuthSecret=this.userAuthParameters="";this.state=
b.State.Uninitialized;this.logger=new Exitgames.Common.Logger("LoadBalancingClient");this.validNextState={};this.initValidNextState();this.currentRoom=this.roomFactoryInternal("");this._myActor=this.actorFactoryInternal("",-1,!0);this.addActor(this._myActor)};b.prototype.onStateChange=function(){};b.prototype.onError=function(a,b){this.logger.error("Load Balancing Client Error",a,b)};b.prototype.onOperationResponse=function(){};b.prototype.onEvent=function(){};b.prototype.onRoomList=function(){};
b.prototype.onRoomListUpdate=function(){};b.prototype.onMyRoomPropertiesChange=function(){};b.prototype.onActorPropertiesChange=function(){};b.prototype.onJoinRoom=function(){};b.prototype.onActorJoin=function(){};b.prototype.onActorLeave=function(){};b.prototype.roomFactory=function(a){return new d(a)};b.prototype.actorFactory=function(a,b,c){return new g(a,b,c)};b.prototype.myActor=function(){return this._myActor};b.prototype.myRoom=function(){return this.currentRoom};b.prototype.myRoomActors=function(){return this.actors};
b.prototype.roomFactoryInternal=function(a){"undefined"===typeof a&&(a="");a=this.roomFactory(a);a._setLBC(this);return a};b.prototype.actorFactoryInternal=function(a,b,c){"undefined"===typeof a&&(a="");"undefined"===typeof b&&(b=-1);"undefined"===typeof c&&(c=!1);a=this.actorFactory(a,b,c);a._setLBC(this);return a};b.prototype.setCustomAuthentication=function(a,b){"undefined"===typeof b&&(b=e.LoadBalancing.Constants.CustomAuthenticationType.Custom);this.userAuthType=b;this.userAuthParameters=a};
b.prototype.connect=function(a){"undefined"===typeof a&&(a=!1);this.reconnectPending=!1;return this.checkNextState(b.State.ConnectingToMasterserver)?(this.changeState(b.State.ConnectingToMasterserver),this.logger.info("Connecting to Master",this.masterServerAddress),this.keepMasterConnection=a,this.masterPeer=new i(this,"ws://"+this.masterServerAddress,""),this.initMasterPeer(this.masterPeer),this.masterPeer.connect(),!0):!1};b.prototype.createRoomFromMy=function(a){this.currentRoom.name=a?a:"";return this.createRoomInternal(this.masterPeer)};
b.prototype.createRoom=function(a,b,c,d,e,g){"undefined"===typeof b&&(b=!0);"undefined"===typeof c&&(c=!0);"undefined"===typeof d&&(d=0);"undefined"===typeof e&&(e={});this.currentRoom=this.roomFactoryInternal(a?a:"");this.currentRoom.isVisible=b;this.currentRoom.isOpen=c;this.currentRoom.maxPlayers=d;this.currentRoom._customProperties=e?e:{};this.currentRoom._propsListedInLobby=g?g:[];this.currentRoom.onPropertiesChange(e);return this.createRoomInternal(this.masterPeer)};b.prototype.joinRoom=function(b){var c=
[];this.currentRoom=this.roomFactoryInternal(b);c.push(a.Constants.ParameterCode.RoomName);c.push(b);this.masterPeer.sendOperation(a.Constants.OperationCode.JoinGame,c);return!0};b.prototype.joinRandomRoom=function(b,c,f){"undefined"===typeof c&&(c=0);"undefined"===typeof f&&(f=a.Constants.MatchmakingMode.FillRoom);var d=[];f!=a.Constants.MatchmakingMode.FillRoom&&(d.push(a.Constants.ParameterCode.MatchMakingType),d.push(f));var f={},e=!1;if(b)for(var g in b)f[g]=b[g],e=!0;0<c&&(f[a.Constants.GameProperties.MaxPlayers]=
c,e=!0);e&&(d.push(a.Constants.ParameterCode.GameProperties),d.push(f));this.masterPeer.sendOperation(a.Constants.OperationCode.JoinRandomGame,d);return!0};b.prototype._setPropertiesOfRoom=function(b){var c=[];c.push(a.Constants.ParameterCode.Properties);c.push(b);c.push(a.Constants.ParameterCode.Broadcast);c.push(!0);this.gamePeer.sendOperation(a.Constants.OperationCode.SetProperties,c)};b.prototype._setPropertiesOfActor=function(b){var c=[];c.push(a.Constants.ParameterCode.ActorNr);c.push(this.myActor().actorNr);
c.push(a.Constants.ParameterCode.Properties);c.push(b);c.push(a.Constants.ParameterCode.Broadcast);c.push(!0);this.gamePeer.sendOperation(a.Constants.OperationCode.SetProperties,c)};b.prototype.disconnect=function(){this.state!=b.State.Uninitialized&&(this.masterPeer&&this.masterPeer.disconnect(),this.gamePeer&&this.gamePeer.disconnect(),this.changeState(b.State.Disconnecting))};b.prototype.leaveRoom=function(){this.isJoinedToRoom()&&(this.gamePeer&&(this.reconnectPending=!0,this.gamePeer.disconnect()),
this.changeState(b.State.Disconnecting))};b.prototype.raiseEvent=function(a,b,c){this.isJoinedToRoom()&&this.gamePeer.raiseEvent(a,b,c)};b.prototype.changeGroups=function(a,b){this.isJoinedToRoom()&&(this.logger.debug("Group change:",a,b),this.gamePeer.changeGroups(a,b))};b.prototype.isConnectedToMaster=function(){return this.masterPeer&&this.masterPeer.isConnected()};b.prototype.isInLobby=function(){return this.state==b.State.JoinedLobby};b.prototype.isJoinedToRoom=function(){return this.state==
b.State.Joined};b.prototype.isConnectedToGame=function(){return this.isJoinedToRoom()};b.prototype.availableRooms=function(){return this.roomInfos};b.prototype.setLogLevel=function(a){this.logger.setLevel(a);this.masterPeer&&this.masterPeer.setLogLevel(a);this.gamePeer&&this.gamePeer.setLogLevel(a)};b.prototype.addActor=function(a){this.actors[a.actorNr]=a};b.prototype.changeState=function(a){this.logger.info("State:",b.StateToName(this.state),"->",b.StateToName(a));this.state=a;this.onStateChange(a)};
b.prototype.createRoomInternal=function(b){var c={};c[a.Constants.GameProperties.IsOpen]=this.currentRoom.isOpen;c[a.Constants.GameProperties.IsVisible]=this.currentRoom.isVisible;0<this.currentRoom.maxPlayers&&(c[a.Constants.GameProperties.MaxPlayers]=this.currentRoom.maxPlayers);this.currentRoom._propsListedInLobby&&0<this.currentRoom._propsListedInLobby.length&&(c[a.Constants.GameProperties.PropsListedInLobby]=this.currentRoom._propsListedInLobby);for(var f in this.currentRoom._customProperties)c[f]=
this.currentRoom._customProperties[f];f=[];this.currentRoom.name&&(f.push(a.Constants.ParameterCode.RoomName),f.push(this.currentRoom.name));f.push(a.Constants.ParameterCode.GameProperties);f.push(c);f.push(a.Constants.ParameterCode.CleanupCacheOnLeave);f.push(!0);f.push(a.Constants.ParameterCode.Broadcast);f.push(!0);b===this.gamePeer&&(f.push(a.Constants.ParameterCode.PlayerProperties),f.push(this._myActor._getAllProperties()));b.sendOperation(a.Constants.OperationCode.CreateGame,f)};b.prototype.initMasterPeer=
function(d){var h=this;d.setLogLevel(this.logger.getLevel());d.addPeerStatusListener(e.PhotonPeer.StatusCodes.error,function(){h.changeState(b.State.Error);h.onError(b.PeerErrorCode.MasterError,"Master peer error")});d.addPeerStatusListener(e.PhotonPeer.StatusCodes.connectFailed,function(){h.changeState(b.State.Error);h.onError(b.PeerErrorCode.MasterConnectFailed,"Master peer connect failed: "+h.masterServerAddress)});d.addPeerStatusListener(e.PhotonPeer.StatusCodes.timeout,function(){h.changeState(b.State.Error);
h.onError(b.PeerErrorCode.MasterTimeout,"Master peer error timeout")});d.addPeerStatusListener(e.PhotonPeer.StatusCodes.connecting,function(){});d.addPeerStatusListener(e.PhotonPeer.StatusCodes.connect,function(){d._logger.info("Connected");var b=[];b.push(a.Constants.ParameterCode.ApplicationId);b.push(h.appId);b.push(a.Constants.ParameterCode.AppVersion);b.push(h.appVersion);h.userAuthType!=a.Constants.CustomAuthenticationType.None&&(b.push(a.Constants.ParameterCode.ClientAuthenticationType),b.push(h.userAuthType),
b.push(a.Constants.ParameterCode.ClientAuthenticationParams),b.push(h.userAuthParameters));d.sendOperation(a.Constants.OperationCode.Authenticate,b);d._logger.info("Authenticate...")});d.addPeerStatusListener(e.PhotonPeer.StatusCodes.disconnect,function(){d._logger.info("Disconnected")});d.addPeerStatusListener(e.PhotonPeer.StatusCodes.connectClosed,function(){d._logger.info("Server closed connection");h.changeState(b.State.Error);h.onError(b.PeerErrorCode.MasterConnectClosed,"Master server closed connection")});
d.addEventListener(a.Constants.EventCode.GameList,function(b){b=b.vals[a.Constants.ParameterCode.GameList];h.roomInfos=[];for(var e in b){var g=new c(e);g._updateFromProps(b[e]);h.roomInfos.push(g)}h.onRoomList(h.roomInfos);d._logger.debug("ev GameList",h.roomInfos,b)});d.addEventListener(a.Constants.EventCode.GameListUpdate,function(b){var b=b.vals[a.Constants.ParameterCode.GameList],e=[],g=[],i=[],j;for(j in b){var l=h.roomInfos.filter(function(a){return a.name==j});0<l.length?(l=l[0],l._updateFromProps(b[j]),
l.removed?i.push(l):e.push(l)):(l=new c(j),l._updateFromProps(b[j]),h.roomInfos.push(l),g.push(l))}h.roomInfos=h.roomInfos.filter(function(a){return!a.removed});h.onRoomListUpdate(h.roomInfos,e,g,i);d._logger.debug("ev GameListUpdate:",h.roomInfos,"u:",e,"a:",g,"r:",i,b)});d.addResponseListener(a.Constants.OperationCode.Authenticate,function(c){d._logger.debug("resp Authenticate",c);c.errCode?(h.changeState(b.State.Error),h.onError(b.PeerErrorCode.MasterAuthenticationFailed,"Master authentication failed")):
(d._logger.info("Authenticated"),h.userAuthSecret=c.vals[a.Constants.ParameterCode.Secret],h.changeState(b.State.ConnectedToMaster),d.sendOperation(a.Constants.OperationCode.JoinLobby),d._logger.info("Join Lobby..."))});d.addResponseListener(a.Constants.OperationCode.JoinLobby,function(c){d._logger.debug("resp JoinLobby",c);c.errCode||(d._logger.info("Joined to Lobby"),h.changeState(b.State.JoinedLobby));h._onOperationResponseInternal2(a.Constants.OperationCode.JoinLobby,c)});d.addResponseListener(a.Constants.OperationCode.CreateGame,
function(b){d._logger.debug("resp CreateGame",b);b.errCode||(h.currentRoom._updateFromMasterResponse(b.vals),d._logger.debug("Created/Joined "+h.currentRoom.name),h.connectToGameServer(!0));h._onOperationResponseInternal2(a.Constants.OperationCode.CreateGame,b)});d.addResponseListener(a.Constants.OperationCode.JoinGame,function(b){d._logger.debug("resp JoinGame",b);b.errCode||(h.currentRoom._updateFromMasterResponse(b.vals),d._logger.debug("Joined "+h.currentRoom.name),h.connectToGameServer(!1));
h._onOperationResponseInternal2(a.Constants.OperationCode.JoinGame,b)});d.addResponseListener(a.Constants.OperationCode.JoinRandomGame,function(b){d._logger.debug("resp JoinRandomGame",b);b.errCode||(h.currentRoom._updateFromMasterResponse(b.vals),d._logger.debug("Joined "+h.currentRoom.name),h.connectToGameServer(!1));h._onOperationResponseInternal2(a.Constants.OperationCode.JoinRandomGame,b)})};b.prototype.connectToGameServer=function(a){this.keepMasterConnection||this.masterPeer.disconnect();return this.checkNextState(b.State.ConnectingToGameserver)?
(this.logger.info("Connecting to Game",this.currentRoom.address),this.gamePeer=new m(this,"ws://"+this.currentRoom.address,""),this.initGamePeer(this.gamePeer,a),this.keepMasterConnection||this.masterPeer.disconnect(),this.gamePeer.connect(),this.changeState(b.State.ConnectingToGameserver),!0):!1};b.prototype.initGamePeer=function(c,d){var f=this;c.setLogLevel(this.logger.getLevel());c.addPeerStatusListener(e.PhotonPeer.StatusCodes.error,function(){f.changeState(b.State.Error);f.onError(b.PeerErrorCode.GameError,
"Game peer error")});c.addPeerStatusListener(e.PhotonPeer.StatusCodes.connectFailed,function(){f.changeState(b.State.Error);f.onError(b.PeerErrorCode.GameConnectFailed,"Game peer connect failed: "+f.currentRoom.address)});c.addPeerStatusListener(e.PhotonPeer.StatusCodes.timeout,function(){f.changeState(b.State.Error);f.onError(b.PeerErrorCode.GameTimeout,"Game peer timeout")});c.addPeerStatusListener(e.PhotonPeer.StatusCodes.connect,function(){c._logger.info("Connected");var b=[];b.push(a.Constants.ParameterCode.ApplicationId);
b.push(f.appId);b.push(a.Constants.ParameterCode.AppVersion);b.push(f.appVersion);f.userAuthType!=a.Constants.CustomAuthenticationType.None&&(b.push(a.Constants.ParameterCode.ClientAuthenticationType),b.push(f.userAuthType),b.push(a.Constants.ParameterCode.Secret),b.push(f.userAuthSecret));c.sendOperation(a.Constants.OperationCode.Authenticate,b);c._logger.info("Authenticate...")});c.addPeerStatusListener(e.PhotonPeer.StatusCodes.disconnect,function(){for(var a in f.actors)f.onActorLeave(f.actors[a]);
f.actors={};f.addActor(f._myActor);c._logger.info("Disconnected");f.masterPeer&&f.masterPeer.isConnected()?f.changeState(b.State.JoinedLobby):(f.changeState(b.State.Disconnected),f.reconnectPending&&f.connect(f.keepMasterConnection))});c.addPeerStatusListener(e.PhotonPeer.StatusCodes.connectClosed,function(){c._logger.info("Server closed connection");f.changeState(b.State.Error);f.onError(b.PeerErrorCode.MasterConnectClosed,"Game server closed connection")});c.addResponseListener(a.Constants.OperationCode.Authenticate,
function(e){c._logger.debug("resp Authenticate",e);e.errCode?(f.changeState(b.State.Error),f.onError(b.PeerErrorCode.GameAuthenticationFailed,"Game authentication failed")):(c._logger.info("Authenticated"),c._logger.info("Connected"),d?f.createRoomInternal(c):(e=[],e.push(a.Constants.ParameterCode.RoomName),e.push(f.currentRoom.name),e.push(a.Constants.ParameterCode.Broadcast),e.push(!0),e.push(a.Constants.ParameterCode.PlayerProperties),e.push(f._myActor._getAllProperties()),c.sendOperation(a.Constants.OperationCode.JoinGame,
e)),f.changeState(b.State.ConnectedToGameserver))});c.addResponseListener(a.Constants.OperationCode.CreateGame,function(d){c._logger.debug("resp CreateGame",d);d.errCode||(f._myActor._updateMyActorFromResponse(d.vals),c._logger.info("myActor: ",f._myActor),f.actors={},f.addActor(f._myActor),f.changeState(b.State.Joined),f.onJoinRoom());f._onOperationResponseInternal2(a.Constants.OperationCode.CreateGame,d)});c.addResponseListener(a.Constants.OperationCode.JoinGame,function(d){c._logger.debug("resp JoinGame",
d);if(!d.errCode){f._myActor._updateMyActorFromResponse(d.vals);c._logger.info("myActor: ",f._myActor);f.currentRoom._updateFromProps(d.vals[a.Constants.ParameterCode.GameProperties]);f.actors={};f.addActor(f._myActor);var e=d.vals[a.Constants.ParameterCode.PlayerProperties],h;for(h in e){var g=f.actorFactoryInternal(e[h][a.Constants.ActorProperties.PlayerName],parseInt(h));g._updateCustomProperties(e[h]);f.addActor(g)}f.changeState(b.State.Joined);f.onJoinRoom()}f._onOperationResponseInternal2(a.Constants.OperationCode.JoinGame,
d)});c.addResponseListener(a.Constants.OperationCode.SetProperties,function(b){c._logger.debug("resp SetProperties",b);f._onOperationResponseInternal2(a.Constants.OperationCode.SetProperties,b)});c.addEventListener(a.Constants.EventCode.Join,function(a){c._logger.debug("ev Join",a);if(g._getActorNrFromResponse(a.vals)===f._myActor.actorNr)f._myActor._updateMyActorFromResponse(a.vals),f.addActor(f._myActor);else{var b=f.actorFactoryInternal();b._updateFromResponse(a.vals);f.addActor(b);f.onActorJoin(b)}});
c.addEventListener(a.Constants.EventCode.Leave,function(a){c._logger.debug("ev Leave",a);if((a=g._getActorNrFromResponse(a.vals))&&f.actors[a]){var b=f.actors[a];delete f.actors[a];f.onActorLeave(b)}});c.addEventListener(a.Constants.EventCode.PropertiesChanged,function(b){c._logger.debug("ev PropertiesChanged",b);var d=b.vals[a.Constants.ParameterCode.TargetActorNr];void 0!==d&&0<d?void 0!==f.actors[d]&&(d=f.actors[d],d._updateCustomProperties(b.vals[a.Constants.ParameterCode.Properties]),f.onActorPropertiesChange(d)):
(f.currentRoom._updateFromProps(b.vals,b.vals[a.Constants.ParameterCode.Properties]),f.onMyRoomPropertiesChange())})};b.prototype._onOperationResponseInternal2=function(a,b){this.onOperationResponse(b.errCode,b.errMsg,a,b.vals)};b.prototype.initValidNextState=function(){this.validNextState[b.State.Error]=[b.State.ConnectingToMasterserver];this.validNextState[b.State.Uninitialized]=[b.State.ConnectingToMasterserver];this.validNextState[b.State.Disconnected]=[b.State.ConnectingToMasterserver];this.validNextState[b.State.ConnectedToMaster]=
[b.State.JoinedLobby];this.validNextState[b.State.JoinedLobby]=[b.State.ConnectingToGameserver];this.validNextState[b.State.ConnectingToGameserver]=[b.State.ConnectedToGameserver];this.validNextState[b.State.ConnectedToGameserver]=[b.State.Joined]};b.prototype.checkNextState=function(a,c){"undefined"===typeof c&&(c=!1);var d=this.validNextState[this.state];if((d=d&&0<=d.indexOf(a))||c)return d;throw Error("LoadBalancingPeer checkNextState fail: "+b.StateToName(this.state)+" -> "+b.StateToName(a));
};b.PeerErrorCode={Ok:0,MasterError:1001,MasterConnectFailed:1002,MasterConnectClosed:1003,MasterTimeout:1004,MasterAuthenticationFailed:1101,GameError:2001,GameConnectFailed:2002,GameConnectClosed:2003,GameTimeout:2004,GameAuthenticationFailed:2101};b.State={Error:-1,Uninitialized:0,ConnectingToMasterserver:1,ConnectedToMaster:2,JoinedLobby:3,ConnectingToGameserver:4,ConnectedToGameserver:5,Joined:6,Disconnecting:7,Disconnected:8};b.StateToName=function(a){return Exitgames.Common.Util.enumValueToName(b.State,
a)};a.LoadBalancingClient=b;var i,n=e.PhotonPeer,j=function(a,b,c){n.call(this,b,c,"Master");this.client=a};__extends(j,n);j.prototype.onUnhandledEvent=function(b,c){this.client.onEvent(b,c.vals[a.Constants.ParameterCode.CustomEventContent],c.vals[a.Constants.ParameterCode.ActorNr])};j.prototype.onUnhandledResponse=function(a,b){this.client.onOperationResponse(b.errCode,b.errMsg,a,b.vals)};i=j;a.MasterPeer=i;var m,p=e.PhotonPeer,j=function(a,b,c){p.call(this,b,c,"Game");this.client=a};__extends(j,
p);j.prototype.onUnhandledEvent=function(b,c){this.client.onEvent(b,c.vals[a.Constants.ParameterCode.CustomEventContent],c.vals[a.Constants.ParameterCode.ActorNr])};j.prototype.onUnhandledResponse=function(a,b){this.client.onOperationResponse(b.errCode,b.errMsg,a,b.vals)};j.prototype.raiseEvent=function(b,c,d){if(this.client.isJoinedToRoom()){this._logger.debug("raiseEvent",b,c,d);b=[a.Constants.ParameterCode.Code,b,a.Constants.ParameterCode.Data,c];if(d&&(void 0!=d.receivers&&d.receivers!==a.Constants.ReceiverGroup.Others&&
(b.push(a.Constants.ParameterCode.ReceiverGroup),b.push(d.receivers)),void 0!=d.cache&&d.cache!==a.Constants.EventCaching.DoNotCache&&(b.push(a.Constants.ParameterCode.Cache),b.push(d.cache)),void 0!=d.interestGroup))if(this.checkGroupNumber(d.interestGroup))b.push(a.Constants.ParameterCode.Group),b.push(d.interestGroup);else throw Error("raiseEvent - Group not a number: "+d.interestGroup);this.sendOperation(a.Constants.OperationCode.RaiseEvent,b)}else throw Error("raiseEvent - Not joined!");};j.prototype.changeGroups=
function(b,c){var d=[];null!=b&&void 0!=b&&(this.checkGroupArray(b,"groupsToRemove"),d.push(a.Constants.ParameterCode.Remove),d.push(b));null!=c&&void 0!=c&&(this.checkGroupArray(c,"groupsToAdd"),d.push(a.Constants.ParameterCode.Add),d.push(c));this.sendOperation(a.Constants.OperationCode.ChangeGroups,d)};j.prototype.checkGroupNumber=function(a){return!("number"!=typeof a||isNaN(a)||Infinity===a||-Infinity===a)};j.prototype.checkGroupArray=function(a,b){if(Exitgames.Common.Util.isArray(a))for(var c=
0;c<a.length;++c){var d=a[c];if(!this.checkGroupNumber(d))throw Error("changeGroups - "+b+" ("+a+") not an array of numbers: element "+c+" = "+d);}else throw Error("changeGroups - groupsToRemove not an array: "+a);};m=j;a.GamePeer=m})(Photon||(Photon={}));
